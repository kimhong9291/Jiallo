<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒæˆ€å»ºæˆ - Excelä¹‹æˆ€</title>
    <style>
        /* å…¨å±€è¨­å®š */
        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", "Yu Gothic", sans-serif;
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* éŠæˆ²ä¸»å®¹å™¨ */
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            background: linear-gradient(to bottom, #ffefef, #ffe4e1);
            /* èƒŒæ™¯è‰²ï¼šæ«»èŠ±ç²‰ */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
        }

        /* èƒŒæ™¯è£é£¾ (Excel ç¶²æ ¼é¢¨æ ¼) */
        .bg-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(#e0e0e0 1px, transparent 1px),
                linear-gradient(90deg, #e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.5;
            z-index: 0;
        }

        /* åœ–ç‰‡ä¸Šè¼‰å€ */
        #upload-section {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px;
            border-radius: 5px;
            font-size: 12px;
        }

        /* è®©å›¾ç‰‡å±…ä¸­ */
        #char-img-display {
            position: absolute;
            /* ç›¸å°æ–¼çˆ¶å®¹å™¨ #game-container å®šä½ */
            top: 50%;
            /* å®šä½èµ·é»å‘ä¸‹ 50% */
            left: 50%;
            /* å®šä½èµ·é»å‘å³ 50% */
            transform: translate(-50%, -50%);
            /* æ ¸å¿ƒï¼šå°‡åœ–ç‰‡è‡ªèº«å‘å·¦ã€å‘ä¸Šå„å¹³ç§» 50%ï¼Œå¯¦ç¾ç²¾ç¢ºå±…ä¸­ */

            /* å°ºå¯¸æ§åˆ¶ï¼Œé˜²æ­¢å¤§åœ–æº¢å‡º */
            max-width: 90%;
            max-height: 90%;
            height: auto;
            /* ä¿æŒåœ–ç‰‡çš„å¯¬é«˜æ¯” */
            width: auto;
            /* ä¿æŒåœ–ç‰‡çš„å¯¬é«˜æ¯” */

            object-fit: contain;
            /* ç¢ºä¿åœ–ç‰‡å®Œæ•´é¡¯ç¤ºåœ¨é™åˆ¶çš„å°ºå¯¸å…§ */
            z-index: 0;
            /* ç¢ºä¿å®ƒåœ¨è§’è‰²ç«‹ç¹ªå’Œå°è©±æ¡†ä¸‹é¢ */
            display: none;
            /* å›¾ç‰‡åœ¨ä¸€å‘¨ç›®é¢„è®¾ä¸ºç©º*/
        }

        /* è§’è‰²ç«‹ç¹ª */
        #character-img {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-height: 90%;
            /* ç«‹ç¹ªé«˜åº¦ */
            z-index: 1;
            transition: filter 0.3s;
        }

        /* å°è©±æ¡†å€åŸŸ */
        #dialogue-box {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            height: 150px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #fff;
            border-radius: 10px;
            z-index: 10;
            padding: 20px;
            color: white;
            display: none;
            /* åˆå§‹éš±è— */
        }

        #name-tag {
            font-size: 24px;
            font-weight: bold;
            color: #ffb7b2;
            margin-bottom: 10px;
        }

        #text-content {
            font-size: 18px;
            line-height: 1.5;
        }

        /* é¸é …å€åŸŸ */
        #options-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 60%;
            text-align: center;
            /* Add this to center options text */
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #ff6b6b;
            padding: 15px;
            text-align: center;
            font-size: 18px;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.2s;
            color: #333;
            font-weight: bold;
        }

        .option-btn:hover {
            background: #ff6b6b;
            color: white;
            transform: scale(1.05);
        }

        /* å¥½æ„Ÿåº¦é¡¯ç¤º */
        #love-meter {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 20px;
            font-weight: bold;
            color: #e84393;
            border: 2px solid #e84393;
        }

        /* é–‹å§‹/é‡ä¾†æŒ‰éˆ•ç•«é¢ */
        #start-screen,
        #end-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 240, 245, 0.95);
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        h1 {
            font-size: 48px;
            color: #d63031;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #fff;
        }

        .action-btn {
            padding: 15px 40px;
            font-size: 24px;
            background-color: #e17055;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #c0392b;
            transition: transform 0.1s;
        }

        .action-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* éŸ³æ¨‚æ’­æ”¾å™¨æ¨£å¼ (ç°¡å–®ç‰ˆ) */
        #music-player {
            position: absolute;
            top: 10px;
            left: 150px;
            z-index: 100;
        }
    </style>
</head>

<body>

    <div id="game-container">
        <div class="bg-grid"></div>

        <div id="upload-section">
            <label for="char-upload">ä¸Šè¼‰å»ºæˆç…§ç‰‡:</label>
            <input type="file" id="char-upload" accept="image/*">
            <button id="clear-img-button">æ¸…ç©ºåœ–ç‰‡</button>
        </div>

        <img id="char-img-display" src="" alt="å»ºæˆç…§ç‰‡">

        <div id="music-player">
            <audio id="bgm" loop controls style="height: 30px;">
                <source src="./media/åƒæ‹ï¼Šä¸‡èŠ± ä¸»é¡Œæ­Œã€Œæ‹ã²æ‹ãµç¸ã€ï¼KOTOKOã€Fullã€‘ã€æ—¥ä¸­æ­Œè©ç¿»è­¯ã€‘ [MtiAJc_F2y0].f234.mp4" type="audio/mp3">
                æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³æ¨‚æ’­æ”¾ã€‚
            </audio>
        </div>

        <div id="love-meter">å¥½æ„Ÿåº¦: <span id="score">0</span> â¤</div>

        <img id="character-img" src="https://via.placeholder.com/300x500/cccccc/000000?text=Please+Upload+Jiancheng"
            alt="æ—å»ºæˆ">

        <div id="dialogue-box">
            <div id="name-tag">æ—å»ºæˆ</div>
            <div id="text-content">...</div>
        </div>

        <div id="options-container"></div>

        <div id="start-screen">
            <h1>åƒæˆ€å»ºæˆ</h1>
            <p>ã€Œé‚£å€‹...ä½ çš„ Excel å…¬å¼å¯«éŒ¯äº†ã€‚ã€</p>
            <button class="action-btn" onclick="startGame()">é–‹å§‹æˆ€æ„›</button>
        </div>

        <div id="end-screen" style="display: none;">
            <h1 id="end-title">çµå±€</h1>
            <p id="end-desc">...</p>
            <button class="action-btn" onclick="restartGame()">é‡æ–°é–‹å§‹</button>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let loveScore = 0;
        let currentSceneId = 0;
        const maxScore = 150;

        // DOM å…ƒç´ 
        const uploadedImgDisplay = document.getElementById('char-img-display');
        const characterImg = document.getElementById('character-img');
        const clearImgButton = document.getElementById('clear-img-button');
        const defaultImageSrc = ''//åˆå§‹åŒ–å›¾ç‰‡ï¼Œé¢„è®¾ä¸ºç©º
        const dialogueBox = document.getElementById('dialogue-box');
        const textContent = document.getElementById('text-content');
        const nameTag = document.getElementById('name-tag');
        const optionsContainer = document.getElementById('options-container');
        const scoreDisplay = document.getElementById('score');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const endTitle = document.getElementById('end-title');
        const endDesc = document.getElementById('end-desc');

        // ä½¿ç”¨ let å…è¨±æˆ‘å€‘åœ¨ resetFileInput å‡½æ•¸ä¸­æ›´æ–°å° input å…ƒç´ çš„å¼•ç”¨
        let fileInput = document.getElementById('char-upload');

        uploadedImgDisplay.src = defaultImageSrc;

        // ----------------------------------------------------
        // æ–‡ä»¶ä¸Šå‚³åŠæ¸…ç©ºæ ¸å¿ƒé‚è¼¯
        // ----------------------------------------------------

        // 1. å®šç¾©å¯é‡ç”¨çš„ä¸Šå‚³è™•ç†å‡½æ•¸
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    uploadedImgDisplay.src = e.target.result;
                    uploadedImgDisplay.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // 2. å®šç¾©å¯é‡ç”¨çš„æ¸…ç©ºé‚è¼¯ (æ ¸å¿ƒä¿®æ­£ï¼šå…‹éš†æ›¿æ›ä»¥æ¸…é™¤æª”æ¡ˆåç¨±é¡¯ç¤º)
        function resetFileInput() {
            // ç²å–ç•¶å‰ file input å…ƒç´ 
            const oldFileInput = fileInput;

            // å‰µå»ºä¸€å€‹æ–°çš„ input å…ƒç´ ï¼ˆæœ€å¯é çš„æ¸…ç©ºæ–¹å¼ï¼‰
            const newFileInput = oldFileInput.cloneNode(true);
            newFileInput.value = ''; // ç¢ºä¿å€¼ç‚ºç©º

            // æ›¿æ›èˆŠçš„ input å…ƒç´ 
            oldFileInput.parentNode.replaceChild(newFileInput, oldFileInput);

            // æ›´æ–° fileInput è®Šæ•¸ç‚ºæ–°çš„å…ƒç´ 
            fileInput = newFileInput;

            // é‡æ–°ç‚ºæ–°çš„ input å…ƒç´ è¨­ç½®äº‹ä»¶ç›£è½å™¨
            fileInput.addEventListener('change', handleFileUpload);
        }

        // åˆå§‹ç¶å®š
        fileInput.addEventListener('change', handleFileUpload);

        // æ¸…ç©ºæŒ‰éˆ•äº‹ä»¶
        clearImgButton.addEventListener('click', function () {
            // 1. é‡ç½®åœ–ç‰‡çš„ src
            uploadedImgDisplay.src = defaultImageSrc;

            // 2. å‘¼å«é‡ç½®å‡½æ•¸ï¼Œæ¸…é™¤æª”æ¡ˆåç¨±
            resetFileInput();

            //3. åœ–ç‰‡å…ƒç´ å®Œå…¨éš±è—
            uploadedImgDisplay.style.display = 'none';
        });

        // ----------------------------------------------------
        // åŠ‡æœ¬æ•¸æ“š
        // ----------------------------------------------------

        const script = [
            {
                id: 0,
                text: "ï¼ˆä½ åœ¨è¾¦å…¬å®¤åŠ ç­ï¼Œçªç„¶æ„Ÿè¦ºèƒŒå¾Œæœ‰ä¸€é“è¦–ç·šã€‚ï¼‰\næ—å»ºæˆï¼šã€Œé€™éº¼æ™šäº†é‚„åœ¨åšå ±è¡¨ï¼Ÿè®“æˆ‘çœ‹çœ‹ä½ çš„æ ¼å¼ã€‚ã€",
                options: [
                    { text: "ç·Šå¼µåœ°é®ä½è¢å¹•", score: -5, next: 1, reaction: "å»ºæˆçšºçœ‰ï¼šã€Œé®é®æ©æ©çš„ï¼Œè‚¯å®šæ˜¯ç”¨æ‰‹å‹•è¨ˆç®—æ©Ÿç®—çš„å§ï¼Ÿã€" },
                    { text: "è‡ªä¿¡åœ°å±•ç¤º VLOOKUP", score: 5, next: 1, reaction: "å»ºæˆé»é»é ­ï¼šã€ŒVLOOKUP...é‚„å¯ä»¥ï¼Œé›–ç„¶æœ‰é»èˆŠï¼Œä½†åŸºç¤ä¸éŒ¯ã€‚ã€" },
                    { text: "ç›´æ¥å±•ç¤º XLOOKUP", score: 15, next: 1, reaction: "å»ºæˆçœ¼ç›ä¸€äº®ï¼šã€Œå–”ï¼Ÿæ‡‚å¾—ç”¨ XLOOKUPï¼Ÿçœ‹ä¾†ä½ ä¸æ˜¯ä¸€èˆ¬äººã€‚ã€" }
                ]
            },
            {
                id: 1,
                text: "æ—å»ºæˆæ¨äº†æ¨çœ¼é¡ï¼ŒæŒ‡è‘—ä½ çš„ D æ¬„ä½ã€‚\næ—å»ºæˆï¼šã€Œé€™è£¡çš„æ•¸æ“šé‡å¾ˆå¤§ï¼Œä½ æ‰“ç®—æ€éº¼æ•´ç†ï¼Ÿã€",
                options: [
                    { text: "åˆä½µå„²å­˜æ ¼ (Merge Cells)", score: -20, next: 2, reaction: "å»ºæˆçš„è‡‰è‰²ç¬é–“ç™¼é»‘ï¼šã€Œåˆä½µå„²å­˜æ ¼æ˜¯ Excel çš„è¬æƒ¡ä¹‹æºï¼ä»¥å¾Œä¸å‡†é€™æ¨£åšï¼ã€" },
                    { text: "ä½¿ç”¨æ¨ç´åˆ†æè¡¨ (Pivot Table)", score: 10, next: 2, reaction: "å»ºæˆéœ²å‡ºå¾®ç¬‘ï¼šã€Œæ˜æ™ºçš„é¸æ“‡ï¼Œæ¨ç´åˆ†æè¡¨æ‰æ˜¯æ•ˆç‡çš„é—œéµã€‚ã€" },
                    { text: "å¯« VBA å·¨é›†è‡ªå‹•åŒ–", score: 20, next: 2, reaction: "å»ºæˆè‡‰ç´…äº†ï¼šã€ŒVBA...ï¼Ÿé€™ç¨®é«˜éšæŠ€å·§...æˆ‘å°ä½ åˆ®ç›®ç›¸çœ‹äº†ã€‚ã€" }
                ]
            },
            {
                id: 2,
                text: "åŠ ç­çµæŸäº†ï¼Œæ—å»ºæˆä¼¼ä¹é‚„ä¸æƒ³èµ°ã€‚\næ—å»ºæˆï¼šã€Œé‚£å€‹...å¦‚æœä½ é€±æœ«æœ‰ç©ºçš„è©±...ã€",
                options: [
                    { text: "ä¸€èµ·å»åƒé£¯å—ï¼Ÿ", score: 5, next: 3, reaction: "å»ºæˆï¼šã€Œåƒé£¯ï¼Ÿå—¯ï¼Œä¹Ÿæ˜¯å¯ä»¥ï¼Œä½†æˆ‘åŸæœ¬æƒ³èªªçš„æ˜¯...ã€" },
                    { text: "æ•™æˆ‘æ›´å¤š Excel æŠ€å·§å§ï¼", score: 20, next: 3, reaction: "å»ºæˆæ¿€å‹•åœ°æ¡ä½ä½ çš„æ‰‹ï¼šã€Œæ²’å•é¡Œï¼æˆ‘æº–å‚™äº†ä¸€å¥—é—œæ–¼ Array Formula çš„èª²ç¨‹ï¼ã€" },
                    { text: "æˆ‘è¦å›å®¶ç¡è¦ºäº†", score: -10, next: 3, reaction: "å»ºæˆï¼šã€Œ...ä¹Ÿæ˜¯ï¼Œä¼‘æ¯æ˜¯ç‚ºäº†èµ°æ›´é•·é çš„è·¯ï¼ˆé‚„æœ‰å¯«æ›´å¤šå…¬å¼ï¼‰ã€‚ã€" }
                ]
            },
            {
                id: 3,
                text: "ä½ æ­£è¦å»å½±å°å®¤ï¼Œå»çœ‹åˆ°å»ºæˆæ­£ç›¯è‘—å½±å°æ©Ÿä¸€è‡‰å›°æƒ‘ã€‚\næ—å»ºæˆï¼šã€Œâ€¦é€™å°æ€éº¼åˆå¡ç´™ï¼Ÿã€",
                options: [
                    {
                        text: "ï¼ˆç†Ÿç»ƒï¼‰æˆ‘æ¥å§ï¼Œæˆ‘å¸¸ä¿®è¿™å°ã€‚",
                        score: 10,
                        next: 4,
                        reaction: "å»ºæˆé©šè¨ï¼šã€Œä½ ä¸åªæœƒ Excelâ€¦é€£å½±å°æ©Ÿéƒ½â€¦å¤ªå¯é äº†å§ï¼Ÿã€"
                    },
                    {
                        text: "ï¼ˆç¬‘ï¼‰å¡çº¸å°±åƒåˆä½µå„²å­˜æ ¼ï¼Œä¸€æ—¦ç™¼ç”Ÿå°±å®Œè›‹ã€‚",
                        score: 5,
                        next: 4,
                        reaction: "å»ºæˆï¼šã€Œå“ˆå“ˆâ€¦ä½ æ¯”æˆ‘é‚„æ¨åˆä½µå„²å­˜æ ¼ã€‚ã€"
                    },
                    {
                        text: "ï¼ˆè®¤çœŸï¼‰ä½ è¦å­¸å—ï¼Ÿæˆ‘æ•™ä½ ã€‚",
                        score: 15,
                        next: 4,
                        reaction: "å»ºæˆè‡‰ç´…ï¼šã€Œä½ â€¦ä½ è¦æ•™æˆ‘ï¼Ÿé‚£â€¦é‚£æˆ‘å¾ˆé¡˜æ„å­¸ã€‚ã€"
                    }
                ]
            },
            {
                id: 4,
                text: "å»ºæˆç›¯è‘—çœ¼å‰ç©ºç™½çš„ Excel è©¦ç®—è¡¨ï¼ŒA1 åˆ° Z100 éƒ½åƒæ²™æ¼ èˆ¬å¯‚å¯ã€‚\nä»–å˜†äº†ä¸€å£æ°£â€”â€”å› ç‚ºæ ¹æœ¬æ²’æœ‰äººæä¾›ä»–éœ€è¦çš„è³‡æ–™ã€‚\nä»–å°±é€™æ¨£æµåœ¨è¢å¹•å‰ï¼Œæ»¿è…¦å­çš„å…¬å¼åœ¨æ­¤åˆ»å»æˆç‚ºäº†ç„¡èƒ½çš„ä¸ˆå¤«ï¼Œä»€éº¼éƒ½è¾¦ä¸åˆ°ã€‚\n",
                options: [
                    {
                        text: "ï¼ˆç„¡å¥ˆï¼‰å”‰ï¼Œå¸Œæœ›è³‡æ–™èƒ½è‡ªå·±é•·å‡ºä¾†ã€‚",
                        score: -10,
                        next: 5,
                        reaction: "å»ºæˆæ­æ°£çš„èªªï¼š[ä½ çœŸæœƒé–‹ç©ç¬‘ã€‚]"
                    },
                    {
                        text: "æ‹æ‹å»ºæˆçš„è‚©è†€ï¼š[è¦ä¸æˆ‘å€‘å…ˆä¼‘æ¯å§ï¼Œåƒäº›æ±è¥¿ï¼Œçœ‹å‡ºä¾†ä½ çš„èƒƒå°±åƒç¾åœ¨çš„cellä¸€æ¨£nullï¼Œæˆ‘è«‹å®¢ï¼Ÿ]",
                        score: 15,
                        next: 5,
                        reaction: "å»ºæˆå¾€å¾Œä»°äº†ä»–çš„è¾¦å…¬æ¤…ï¼Œç„¶å¾ŒæŠ¬é ­èªªï¼šã€Œèªªçš„ä¹Ÿæ˜¯ï¼Œæˆ‘å€‘ä¸€èµ·å»åƒå§ã€‚ä¸...ä¸é... , ä¸...ä¸ç”¨ä½ è«‹å®¢äº†ã€‚ã€\nä½ çœ‹è¦‹ä»–èªªå®Œé€™æ®µè©±å¾Œè‡‰ä¸Šç•¥é¡¯ç´…æšˆã€‚"
                    },
                    {
                        text: "ä¸»å‹•è·Ÿå»ºæˆèªªï¼š[æˆ–è¨±...æˆ‘å¯ä»¥å¹«ä½ ç”Ÿæˆè³‡æ–™ï¼Ÿ]",
                        score: 20,
                        next: 5,
                        reaction: "å»ºæˆé©šå–œåœ°æœ›å‘å¾Œæ–¹çš„ä½ ï¼š[çœŸ...çœŸçš„å—ï¼Ÿï¼å¤ªå¥½äº†æˆ‘æ­£æ„è‘—æ²’æœ‰äº‹æƒ…åšå‘¢ï¼]"
                    }
                ]
            },
            {
                id: 5,
                text: "æ—å»ºæˆçµ¦äº†ä½ ä¸€ä»½å¥‡æ€ªçš„è³‡æ–™è¡¨ã€‚\næ—å»ºæˆï¼šã€Œé€™æ˜¯æˆ‘å¹³å¸¸ç”¨ä¾†æ¸¬è©¦æ–°äººèƒ½åŠ›çš„â€¦ä½ èƒ½ç”¨ä¸€è¡Œå…¬å¼è§£æ±ºå—ï¼Ÿã€",
                options: [
                    {
                        text: "ä½¿ç”¨ FILTER + UNIQUE",
                        score: 15,
                        next: 6,
                        reaction: "å»ºæˆçœ¼ç›äº®äº†ï¼šã€Œé™£åˆ—å…¬å¼â€¦å¤ªå¼·äº†ï¼Œä½ çœŸçš„ä¸æ˜¯ä¸€èˆ¬äººã€‚ã€"
                    },
                    {
                        text: "ä½¿ç”¨å‚³çµ±çš„é€²éšç¯©é¸",
                        score: 5,
                        next: 6,
                        reaction: "å»ºæˆé»é ­ï¼šã€Œé›–ç„¶è€æ–¹æ³•ï¼Œä½†è‡³å°‘ä½ çŸ¥é“åŸç†ã€‚ã€"
                    },
                    {
                        text: "æˆ‘â€¦æˆ‘å¯ä»¥å…ˆ Google å—ï¼Ÿ",
                        score: -20,
                        next: 6,
                        reaction: "å»ºæˆæ‰¶äº†æ‰¶çœ¼é¡ï¼šã€Œå”‰â€¦è‡³å°‘ä½ èª å¯¦ã€‚ã€"
                    }
                ]
            },
            {
                id: 6,
                text: "æ—å»ºæˆå› ç‚ºè®“é¡§å®¢åœ¨è‡ªå·±çš„excelè¡¨ä¸­æ‰¾å‡ºè‡ªå·±å¾ä¾†æ²’åœ¨è¡¨ä¸­è¨˜éŒ„çš„featureï¼Œå°è‡´ç¾åœ¨è¢«é¡§å®¢ç—›ç½µä¸­ã€‚",
                options: [
                    {
                        text: "ç‚ºå»ºæˆè§£åœï¼Œä¸¦è·Ÿé¡§å®¢å’Œä¸Šå¸è¡¨ç¤ºè‡ªå·±æœƒæ”¬ä¸‹é€™æ¬¡çš„å¤±èª¤çš„è·è²¬ã€‚",
                        score: 25,
                        next: 7,
                        reaction: "å»ºæˆå›å»è·Ÿæˆ‘ç´°è²èªªï¼š[ä½ å…¶å¯¦...å¯ä»¥ä¸ç”¨é€™æ¨£å¹«æˆ‘...ä¸éï¼Œè¬è¬ä½ ï¼Œæ²’æœ‰ä½ çš„è©±æˆ‘...ä¸çŸ¥é“æ€éº¼è¾¦äº†...]"
                    },
                    {
                        text: "åœ¨é¡§å®¢é¢å‰ç‚ºå»ºæˆæ‰“æŠ±ä¸å¹³ã€‚",
                        score: -25,
                        next: 7,
                        reaction: "ç™¼ç¾åˆ°é€™çœŸæ˜¯å»ºæˆçš„å¤±èª¤ï¼Œå°è‡´è‡ªå·±ä¹Ÿå’Œå»ºæˆä¸€èµ·é­å—åˆ°æ›´é›£è½çš„ç½µè²ã€‚"
                    },
                    {
                        text: "æ²‰é»˜ï¼ŒçµæŸå¾Œç§åº•ä¸‹å®‰æ…°å»ºæˆã€‚",
                        score: 10,
                        next: 7,
                        reaction: "å»ºæˆå“­æ³£å®Œå¾Œï¼Œç·©ç·©èªªè‘—è‡ªå·±ä¸‹æ¬¡ä¸æœƒçŠ¯ä¸‹é€™æ¨£çš„å¤±èª¤äº†ã€‚"
                    }
                ]
            },
            {
                id: 7,
                text: "ä½ åœ¨èŒ¶æ°´é–“æ³¡å’–å•¡æ™‚ï¼Œæ„å¤–è½åˆ°å»ºæˆåœ¨è·ŸåŒäº‹èŠå¤©ã€‚\nå»ºæˆï¼šã€Œâ€¦å¥¹çš„å…¬å¼å¯«å¾—æ¯”æˆ‘æƒ³åƒä¸­é‚„å¥½ï¼Œå’Œ...å’Œä»–çš„æº«æŸ”ä¸€æ¨£å¥½...ã€",
                options: [
                    {
                        text: "ï¼ˆèµ°å‡ºå»ï¼‰ä½ å‰›å‰›æ˜¯åœ¨ç¨±è®šæˆ‘å—ï¼Ÿ",
                        score: 15,
                        next: 8,
                        reaction: "å»ºæˆè¢«ä½ åš‡åˆ°ï¼šã€Œå’³å’³â€¦æˆ‘ã€æˆ‘åªæ˜¯åœ¨è¬›äº‹å¯¦ã€‚ã€"
                    },
                    {
                        text: "ï¼ˆå·è½åˆ°æœ€å¾Œï¼‰å˜»â€¦å†è¬›å¤šä¸€é»å˜›",
                        score: 10,
                        next: 8,
                        reaction: "å»ºæˆå¿½ç„¶å¯Ÿè¦ºï¼šã€Œæ¬¸ï¼Ÿä½ åœ¨é‚£é‚Šå¾ˆä¹…äº†â€¦ï¼Ÿã€"
                    },
                    {
                        text: "ï¼ˆå‡è£…æ²¡å¬åˆ°ï¼‰é»˜é»˜ç¦»å¼€",
                        score: 5,
                        next: 8,
                        reaction: "å»ºæˆå¾Œä¾†è¿½ä¸Šä½ ï¼šã€Œä½ å‰›å‰›æ˜¯ä¸æ˜¯â€¦ç®—äº†ï¼Œç•¶æˆ‘æ²’èªªã€‚ã€"
                    }
                ]
            },
            {
                id: 8,
                text: "ï¼ˆé€™æ˜¯æœ€å¾Œçš„é—œéµæ™‚åˆ»...ï¼‰\næ—å»ºæˆæ‹¿å‡ºä¸€ä»½è©¦ç®—è¡¨ï¼Œä¸Šé¢çš„å„²å­˜æ ¼æ‹¼æˆäº†ä¸€å€‹æ„›å¿ƒå½¢ç‹€ã€‚",
                options: [
                    { text: "ã€Œé€™æ˜¯æ¢ä»¶å¼æ ¼å¼è¨­å®šå—ï¼Ÿå¥½ç¾ï¼ã€", score: 20, next: 9999, reaction: "å»ºæˆï¼šã€Œæ²’éŒ¯ï¼æ˜¯åˆ©ç”¨ $ROW å’Œ $COLUMN åƒæ•¸ç®—å‡ºä¾†çš„ï¼ä½ ç«Ÿç„¶æ‡‚ï¼ã€" }, // 99 ä»£è¡¨çµå±€
                    { text: "ã€Œä½ çš„æ¬„å¯¬å¥½åƒæ²’æœ‰èª¿æ•´å¥½ã€‚ã€", score: -30, next: 9999, reaction: "å»ºæˆï¼šã€Œï¼ˆè‡‰è‰²è’¼ç™½ï¼‰...å°ä¸èµ·ï¼Œæ˜¯æˆ‘å¤ªç²—å¿ƒäº†ã€‚ã€" },
                    { text: "é»˜é»˜å­˜æª”ä¸¦å‚™ä»½", score: 10, next: 9999, reaction: "å»ºæˆï¼šã€Œä½ çœŸæ˜¯å€‹å„ªç§€çš„æ•¸æ“šäººï¼Œæ°¸é æŠŠè³‡æ–™å®‰å…¨æ”¾åœ¨ç¬¬ä¸€ä½ã€‚ã€" }
                ]//æš‚å®šä¸ºç»å¯¹final
            },

        ];

        // ----------------------------------------------------
        // éŠæˆ²æµç¨‹æ§åˆ¶
        // ----------------------------------------------------

        function startGame() {
            loveScore = 0;
            currentSceneId = 0;
            updateScore();
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            dialogueBox.style.display = 'block';

            // éŠæˆ²é–‹å§‹æ™‚ï¼Œæ’­æ”¾éŸ³æ¨‚
            const audio = document.getElementById('bgm');
            audio.volume = 0.3;
            audio.play().catch(e => console.log("éœ€ä½¿ç”¨è€…äº’å‹•æ‰èƒ½æ’­æ”¾éŸ³æ¨‚æˆ–è¢«é˜»æ­¢ã€‚"));

            showScene(0);
        }

        function updateScore() {
            scoreDisplay.innerText = loveScore;
        }

        // ç§»é™¤åŸæœ‰çš„ nextHandler ç›£è½å™¨ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œé¿å…é‡è¤‡è§¸ç™¼
        let currentNextHandler = null;

        function showScene(index) {
            // æ¸…ç©ºèˆŠé¸é …
            optionsContainer.innerHTML = '';

            // ç§»é™¤èˆŠçš„é»æ“Šäº‹ä»¶ç›£è½å™¨
            if (currentNextHandler) {
                dialogueBox.removeEventListener('click', currentNextHandler);
                currentNextHandler = null;
            }

            // ç²å–ç•¶å‰å ´æ™¯æ•¸æ“š
            const scene = script.find(s => s.id === index);

            if (!scene) {
                console.error("Scene not found");
                return;
            }

            // é¡¯ç¤ºæ–‡å­— 
            nameTag.innerText = (index === 0 && scene.text.includes("ï¼ˆ")) ? "æ—ç™½" : "æ—å»ºæˆ";
            textContent.innerText = scene.text;

            // å‰µå»ºé¸é …æŒ‰éˆ•
            scene.options.forEach(option => {
                const btn = document.createElement('div');
                btn.className = 'option-btn';
                btn.innerText = option.text;
                btn.onclick = () => handleChoice(option);
                optionsContainer.appendChild(btn);
            });
        }

        function handleChoice(option) {
            // æ›´æ–°åˆ†æ•¸
            loveScore += option.score;
            updateScore();

            // éš±è—é¸é …ï¼Œé¡¯ç¤ºåæ‡‰
            optionsContainer.innerHTML = '';
            nameTag.innerText = "æ—å»ºæˆ";

            const reactionText = option.reaction || "ï¼ˆå ´æ™¯çµæŸï¼Œé»æ“ŠæŸ¥çœ‹çµå±€ï¼‰";
            textContent.innerText = reactionText;

            // å®šç¾©ä¸‹ä¸€å€‹å ´æ™¯çš„è™•ç†å‡½æ•¸
            const nextHandler = () => {
                // ç§»é™¤ç•¶å‰çš„ç›£è½å™¨
                dialogueBox.removeEventListener('click', currentNextHandler);
                currentNextHandler = null;

                if (option.next === 9999) {
                    showEnding();
                } else {
                    showScene(option.next);
                }
            };

            currentNextHandler = nextHandler; // ä¿å­˜ç•¶å‰çš„è™•ç†å‡½æ•¸

            // å»¶é²ä¸€é»è®“ç©å®¶çœ‹å®Œåæ‡‰å†é»æ“Š
            setTimeout(() => {
                dialogueBox.addEventListener('click', currentNextHandler);
                // æ·»åŠ ä¸€å€‹æç¤ºæ–‡å­—
                const tip = document.createElement('div');
                tip.style.fontSize = "12px";
                tip.style.color = "#ccc";
                tip.style.textAlign = "right";
                tip.innerText = "â–¼ é»æ“Šç¹¼çºŒ";
                textContent.appendChild(tip);
            }, 500);
        }

        function showEnding() {
            // ç¢ºä¿ç§»é™¤æ‰€æœ‰ç›£è½å™¨ï¼Œé˜²æ­¢çµæŸç•«é¢è¢«é»æ“Šå½±éŸ¿
            if (currentNextHandler) {
                dialogueBox.removeEventListener('click', currentNextHandler);
                currentNextHandler = null;
            }

            dialogueBox.style.display = 'none';
            optionsContainer.innerHTML = '';
            endScreen.style.display = 'flex';

            if (loveScore >= 131) {
                endTitle.innerText = "True End: æ°¸æ†çš„å·¨é›†";
                endTitle.style.color = "#e84393";
                endDesc.innerText = `ä½ å€‘çš„æ„›æƒ…å°±åƒä¸€å€‹å®Œç¾çš„ Loopï¼Œæ°¸é ä¸æœƒå ±éŒ¯ã€‚\næœ€çµ‚å¥½æ„Ÿåº¦ï¼š${loveScore}`;
                characterImg.style.filter = "drop-shadow(0 0 20px gold)"; // ç™¼å…‰ç‰¹æ•ˆ
            } else if (loveScore >= 70) {
                endTitle.innerText = "Normal End: åŒäº‹ä»¥ä¸Š";
                endTitle.style.color = "#0984e3";
                endDesc.innerText = `ä½ å€‘æˆç‚ºäº† Excel äº¤æµæœƒçš„å¥½å¤¥ä¼´ã€‚\næœ€çµ‚å¥½æ„Ÿåº¦ï¼š${loveScore}`;
                characterImg.style.filter = "none";
            } else if(loveScore>-131){
                endTitle.innerText = "Bad End: #REF!";
                endTitle.style.color = "#636e72";
                endDesc.innerText = `å»ºæˆè¦ºå¾—è·Ÿä½ æ²’æœ‰å…±åŒèªè¨€ï¼ˆExcel èªè¨€ï¼‰ã€‚\nä»–æ‹’çµ•äº†ä½ çš„å­˜æª”è«‹æ±‚ã€‚\næœ€çµ‚å¥½æ„Ÿåº¦ï¼š${loveScore}`;
                characterImg.style.filter = "grayscale(100%)"; // è®Šé»‘ç™½
            }
            else{
                endTitle.innerText = "Bad End: #REF!";
                endTitle.style.color = "#636e72";
                endDesc.innerText = `å»ºæˆè¦ºå¾—è·Ÿä½ æ²’æœ‰å…±åŒèªè¨€ï¼ˆExcel èªè¨€ï¼‰ã€‚\nä»–æ‹’çµ•äº†ä½ çš„å­˜æª”è«‹æ±‚ã€‚\næœ€çµ‚å¥½æ„Ÿåº¦ï¼š${loveScore}`;
                characterImg.style.filter = "grayscale(100%)"; // è®Šé»‘ç™½
            }
        }

        function restartGame() {
            // 1. é‡ç½®è§’è‰²ç«‹ç¹ªçš„è¦–è¦ºç‰¹æ•ˆ
            characterImg.style.filter = "none";

            // 2. éš±è—æ‰€æœ‰éŠæˆ²ä¸­çš„å…ƒç´ 
            dialogueBox.style.display = 'none';
            optionsContainer.innerHTML = '';
            uploadedImgDisplay.style.display = 'none'; // éš±è—ä¸Šå‚³çš„åœ–ç‰‡
            endScreen.style.display = 'none';

            // ğŸš¨ é—œéµä¿®æ­£ï¼šé‡ç½®æª”æ¡ˆä¸Šå‚³æ¬„ä½ï¼Œæ¸…ç©ºåœ–ç‰‡åç¨±ï¼
            resetFileInput();

            // 3. é¡¯ç¤ºé–‹å§‹ç•«é¢ (è®“ç©å®¶å¯ä»¥é»æ“Šã€Œé–‹å§‹æˆ€æ„›ã€)
            startScreen.style.display = 'flex';
        }
    </script>
</body>

</html>